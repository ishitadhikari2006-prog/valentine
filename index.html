<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Valentine Game</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{
  background:#fff;
  overflow:hidden;
  font-family:Arial,sans-serif;
}

/* GAME CONTAINER */
#game{
  position:relative;
  width:100vw;
  height:100vh;
  background:#fff;
  overflow:hidden;
}

/* JERRY */
#jerry{
  position:absolute;
  bottom:80px;
  left:60px;
  width:60px;
  height:60px;
  z-index: 2;
}

/* OBSTACLE */
.obstacle{
  position:absolute;
  bottom:70px;
  width:40px;
  height:90px;
  background:#000;
  z-index: 1;
}

/* TEXT BOX & BUTTONS */
#textBox{
  position:absolute;
  top:20%;
  width:100%;
  text-align:center;
  font-size:20px;
  font-weight: bold;
  display:none;
  z-index:5;
  padding: 0 20px;
}

/* BUTTON STYLES */
button {
  padding: 10px 20px;
  font-size: 16px;
  margin: 10px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
}
.btn-yes { background-color: #ff4d4d; color: white; }
.btn-no { background-color: #ccc; color: black; }

/* VIDEO FULLSCREEN */
#videoWrap{
  position:fixed;
  inset:0;
  background:#000;
  display:none;
  z-index:999;
}
#videoWrap video{
  width:100%;
  height:100%;
  object-fit:cover;
}
</style>
</head>

<body>

<div id="videoWrap">
  <video id="valVideo" autoplay muted playsinline>
    <source src="video.mp4" type="video/mp4">
  </video>
</div>

<div id="game">
  <img id="jerry" src="jerry.png">
  
  <div id="textBox">
    Do you now accept your bf is always right in every argument and wanna be his Valentine? üòº‚ù§Ô∏è  
    <br><br>
    <button class="btn-yes" onclick="restart()">Yes / Restart</button>
    <button class="btn-no" onclick="tapNo()">No</button>
  </div>
</div>

<script>
const game = document.getElementById("game");
const jerry = document.getElementById("jerry");
const videoWrap = document.getElementById("videoWrap");
const video = document.getElementById("valVideo");
const textBox = document.getElementById("textBox");

let y = 0;
let vy = 0;
let gravity = 0.25; // Slightly heavier gravity for better feel
let playing = true;
let obs;
let noCount = 0;

function createObstacle(){
  obs = document.createElement("div");
  obs.className = "obstacle";
  obs.style.left = "100vw";
  game.appendChild(obs);
}
createObstacle();

function loop(){
  if(!playing) return;

  // JUMP PHYSICS
  vy -= gravity;
  y += vy;
  if(y < 0){ y = 0; vy = 0; }

  jerry.style.bottom = (80 + y) + "px";

  // OBSTACLE MOVE
  // We use getBoundingClientRect for more accurate collision
  let obsRect = obs.getBoundingClientRect();
  let jerryRect = jerry.getBoundingClientRect();
  
  // Move obstacle logic
  let currentLeft = parseFloat(obs.style.left) || 100; 
  // Note: We use pixel movement logic below based on offsetLeft for simplicity
  let x = obs.offsetLeft - 5; // Speed 5
  obs.style.left = x + "px";

  // RESET OBSTACLE LOOP
  if(x < -50){
    obs.style.left = "100vw";
  }

  // COLLISION DETECTION
  // If Jerry's right side > Obstacle left side
  // AND Jerry's left side < Obstacle right side
  // AND Jerry is not high enough (y < 90)
  if(x < 110 && x > 40 && y < 90){
    endGame();
  }

  requestAnimationFrame(loop);
}
loop();

// TAP TO JUMP
game.onclick = (e)=>{
  // Prevent jump if clicking buttons
  if(e.target.tagName === 'BUTTON') return;

  if(playing && y === 0){
    vy = 8.5; // FIXED: Increased jump power to clear the 90px obstacle
  }
};

function endGame(){
  playing = false;
  textBox.style.display = "block";
}

// THE MISSING NO BUTTON FUNCTION
function tapNo(){
  noCount++;
  // Move the No button around or show alert if you want
  // For now, let's keep your logic: trigger video at 14 clicks
  
  if(noCount >= 5) {
     alert("You can't say no! üò§");
  }
  
  if(noCount === 14){
    videoWrap.style.display = "block";
    video.currentTime = 0;
    video.play();

    video.onended = ()=>{
      videoWrap.style.display = "none";
      restart();
    };
  }
}

function startGame(){
  playing = true;
  y = 0; vy = 0;
  
  // RESET OBSTACLE POSITION
  obs.style.left = "100vw";
  
  textBox.style.display = "none";
  
  // FIXED: Small delay to let browser render the reset before looping
  // This prevents the "Death Loop" bug
  setTimeout(() => {
    loop();
  }, 100);
}

function restart(){
  startGame();
}
</script>

</body>
</html>
